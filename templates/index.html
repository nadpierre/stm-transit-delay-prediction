<!DOCTYPE html>
<html>
<head>
    <title>STM Bus Arrival Time Predictor</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style type="test/css">
        
    </style>
</head>
<body>
    <h1>Predict Bus Arrival Time</h1>
    <form method="post" action="/predict">
        <label for="bus_line">Select Bus Line:</label>
        <select id="bus_line" name="bus_line">
            {% for line in bus_lines %}
                <option style="background-color: '{{ line.backgroundColor }}'; color: '{{ line.fontColor }}';" value="{{ line.id }}">{{ line.id }}</option>
            {% endfor %}
        </select>
        
        <br><br>

        <label>Direction:</label><br>
        {% for direction in directions %}
            <input type="radio" id="direction_east" name="direction" value="{{ direction.id }}">{{ direction.name }}<br>
        {% endfor %}
        <br>

        <label for="stop">Select Stop:</label>
        <select id="stop" name="stop">
            {% for stop in bus_stops %}
                <option value="{{stop.id}}">{{stop.name}}</option>
            {% endfor %}
        </select>

        <br><br>

        <label for="expected_arrival">Expected Arrival Time:</label>
        <input type="datetime-local" id="expected_arrival" name="expected_arrival">

        <br><br>
        <button type="submit">Predict Arrival Time</button>
    </form>
    
    {% if prediction %}
        <!-- TODO: early (orange), on time (green), late (red) -->
        <h2>Predicted Arrival Time: {{ prediction }}</h2>
    {% endif %}
    {% if error %}
        <h3 style="color:red">{{ error.message }}</h3>
    {% endif %}

    <script>
        $(document).ready(function() {
            $('input[name="direction"]').on('change', function() {
                const busLine = $('#bus_line').val();
                const direction = $(this).val();
                
                $.ajax({
                    url: '/get_stops',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ bus_line: busLine, direction: direction }),
                    success: function(data) {
                        $('#stop').empty();
                        $.each(data, function(index, value) {
                            $('#stop').append(`<option value="${value}">${value}</option>`);
                        });
                    }
                });
            });
        });
    </script>
</body>
</html>
